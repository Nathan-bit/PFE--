<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table- <%= tableName.toUpperCase() %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-b7XdwVuK2ynVMh6qZIxlP4w39d/2B3qoSTqY5m5+jubpHhEYBzvIrw3w2AzPWwPOkKl2BkEL1jfr2BGdChtRwg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <link rel="stylesheet" href="../public/css/dashboard.css">

    <%- include('./partial/crud_header') %>

    <style>
            .table-responsive {
        max-height: 600px; /* Set the maximum height for the table */
        overflow-y: auto; /* Enable vertical scrollbar */  
    }
    .modal-dialog {
    max-width: calc(30% - 15px); /* Adjust as needed */
    margin: 1rem auto;
    } 
 .button-container {
  text-align: center;
   }
   
    </style>
    
</head>
<body>
<div class="container " >
    <%-include('./common/sidebar') %>
       <div class="main-content">
        <%-include('./common/navbar') %>

         <div class="my-custom-class">
            <h5 >
                <a href="/gestion">
                <i class="fas fa-home"></i>  <button class="btn btn-outline-li btn-sm"> Back to Home</button>
                </a>
             </h5>    
               
       <button type="button" class="btn btn-success mb-3 float-right" data-toggle="modal" data-target="#addModal">
           <i class="fas fa-plus"></i> Add New <%= tableName %>
       </button>
       <div class="button-container">
           <button class="btn btn-outline-info btn-sm" >
            <h6>Les Donn√©es - <%= tableName.toUpperCase() %> <strong style="color:rgb(0, 0, 0);"> (<%= count %>)</strong></h6> 
             
           </button>
         </div>
        
       <% if (data.length > 0) { %>
           <div class="mb-6">
               <input type="text" id="searchInput" class="form-control mr-sm-2" placeholder="Search...">
           </div>
                           <p> <%-include('./partial/flaskMessages')  %></p>
   
       <div class=" table-responsive  " style="background-color: beige; border-radius: 5px;" >
           <table class=" table table-striped table-bordered table-hover table-sm searchable sortable">
               <thead class="thead-dark">
               <tr class="text-center">
                   <% Object.keys(data[0]).forEach(key => { %>
                   <th ><%= key %></th>
                   <% }); %>
                   <th>Views</th>
                   <th>Edit</th>
                   <th>Delete</th>
               </tr>
               </thead>
               <tbody id="tableBody"  >
               <% data.forEach(row => { %>
               <tr > <!-- class="font-weight-bold text-center" -->
                   <% Object.values(row).forEach(value => { %>
                   <td ><%= value %></td>
                   <% }); %>
                   <td>
                       <button type="button" class="btn btn-warning btn-sm" data-toggle="modal"
                               data-target="#viewsModal<%= row.EMAIL.replace(/[@.]/g, '\\$&') %>">
                           <i class="fas fa-eye"></i>Views
                       </button>
   
                       <!-- modal fade for views -->
                       <div class="modal fade" id="viewsModal<%= row.EMAIL %>" tabindex="-1" role="dialog" aria-labelledby="viewsModalLabel<%= row.EMAIL.replace(/\[@.\]/g, '\\\\$&') %>" aria-hidden="true">
                           <div class="modal-dialog modal-dialog-scrollable" role="document">
                               <div class="modal-content">
                                   <div class="modal-header">
                                       <button class="btn btn-outline-dark  btn-block " class="modal-title" id="viewsModalLabel<%= row.EMAIL.replace(/\[@.\]/g, '\\\\$&') %>"> About :  <%= row.EMAIL%></button>
                                       <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                           <span aria-hidden="true">&times;</span>
                                       </button>
                                   </div>
                                   <div class="modal-body" id="modalBody<%= row.EMAIL %>">
                                       <!-- Display all the information about the row in read-only mode -->
                                       <table class="table table-bordered" id="dataTable">
                                           <% Object.keys(row).forEach(key => { %>
                                           <tr>
                                               <th><%= key %></th>
                                               <td><%= row[key] %></td>
                                           </tr>
                                           <% }); %>
                                       </table>
                                   </div>
                                   <div class="modal-footer">
                                       <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                   </div>
                               </div>
                           </div>
                       </div>
                       
                  
                   </td>
                   <td>
                       <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                               data-target="#editModal<%= row.EMAIL.replace(/[@.]/g, '\\$&') %>">
                           <i class="fas fa-edit"></i> Edit
                       </button>
                   </td>
                   <td>
                       <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
                               data-target="#deleteModal<%= row.EMAIL.replace(/[@.]/g, '\\$&') %>">
                           <i class="fas fa-trash"></i> Delete
                       </button>
                   </td>
               </tr>
               <!-- delete modal fade -->
               <div class="modal fade" id="deleteModal<%= row.EMAIL %>" tabindex="-1" role="dialog"
                    aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
                   <div class="modal-dialog modal-sm">
                       <div class="modal-content">
                           <div class="modal-header">
                               <h5 class="modal-title" id="deleteConfirmationLabel">Confirm Delete</h5>
                               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                   <span aria-hidden="true">&times;</span>
                               </button>
                           </div>
                           <div class="modal-body">
                               <p> You sure you want to  <em style="color: red;">permanently delete</em> : <strong><%=row.EMAIL %></strong>  and his informations from  <strong><em><%= tableName.toUpperCase() %></em> </strong>  ?   </p>
                           </div>
                           <div class="modal-footer">
                               <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                               <a href="/gestion/<%= tableName %>/delete/<%= row.EMAIL %>" class="btn btn-danger">Delete</a>
                           </div>
                       </div>
                   </div>
               </div>
               <% }); %>
               </tbody>
           </table>
       </div>
       <!-- Bootstrap Pagination -->
       <% } else { %>
       <h2><p style="text-align: center; color: red;"> <%= tableName.toUpperCase() %> has no records</p></h2>
       <% } %>
   
          </div>
     </div>
    
</div>
<%-include('./partial/crud_fades') %>
<!-- Include Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

<script>
    $(document).ready(function(){
        $('#searchInput').on('keyup', function() {
            var value = $(this).val().toLowerCase();
            $('#tableBody tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>

</body>
</html>